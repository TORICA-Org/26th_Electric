# 電装班
26代電装班長とシミュレーター班長を兼任する永田です．本稿では，25代で新たに導入した装置について述べたいと思います．鳥科の後輩のみならず，鳥人間に関わる皆様の助けになれる部分が少しでもあれば幸いです．
## AoA・AoSの計測用ベーン型風向計
今年の目玉はコレです．最高に格好良くて惚れ惚れします．角度の検出は磁気式エンコーダーAS5600を使用し，ベーンは3Dプリンターで製作しました．
 
エアデータセンサー部
今回，MATLABを使用して得られたデータを解析し，琵琶湖上空の風向ベクトルを求めてみました．大学のアカウントに感謝です．手順を以下に示します．
###	1.GPSと高度計のログから3次元的な対地速度を求める
GPSでの2つの測定点の距離と測定時刻の差から，NED座標系における対地速度を求めました．「NED座標とは，North-East-Down（北-東-下) の3方向を正とする3次元の 座標系のこと」（Wikipedia）です．求めた対地速度は，2つの測定点の中点における瞬間の速度とみなしました．ここでは，求めた速度を方角ごとにV_N_g，V_E_g，V_D_gとします．MATLABでは地球楕円体（WGS84楕円体）やdistance関数が利用できるので，比較的簡単に求められます．
 
NED座標系
### 2.AoA・AoSとピトー管のログから機体座標系の対気速度を求める
まず，AoAのログを評価しました．以下にグラフを示します．

 

「AoAは適当なオフセットをかけるとピッチとよく一致する」ことから，グラフを見ながら目視でオフセットを-9.2に決めました．雑で申し訳ありません．

次はAoSです．同様にグラフを示します．

 

着水直前の左バンクにより，左に横滑りした様子が見てとれます．一方で離陸直後は，AoSが35秒付近まで長い周期で振動し続けています．それ以降は収束したものの，風向ベクトルの推定に影響が出そうです．

最後に，それぞれ機体前方，右方，下方を正とする機体座標系の速度U，V，Wをとり，AoAを，AoSをとして，ピトー管により測定した対気速度vairを分解しました．

U=v_{air}\cdot c o s{\alpha}\cdot c o s{\beta}\bigmV=v_{\mathrm{air}}\cdot c o s{\alpha}\cdot s i n{\beta}\bigmW=v_{\mathrm{air}}\cdot s i n{\alpha}\cdot c o s{\beta}

注意しなければならないのは，ピッチを上げたときAoAは大きくなり，右に横滑りするときにAoSはプラスになるということです．
 
AoAとAoS
### 3.オイラー角のログから対気速度をNED座標系に変換する
先ほど求めた機体座標系における対気速度をNED座標系に変換しました．ここでは，ロール（)，ピッチ（ )は水平を基準とし，それぞれ，右バンク（右翼が下がる）方向，機首上げ方向を正としました．また，ヨー（)は北方位を基準として東方位を正としました．回転行列により座標変換を行いましたが，ここでの注意点はロールの符号を反転させなければならないことです．ロールは，機体後方から見て時計回りを正としました．しかしながら，回転行列の数学的定義は反時計回りが正となっているためです．（単位円を書くときも，基本的には反時計回りに角度を取るはずです．）これも考慮した回転行列Rは以下のようになります．


$\mathbit{R}=\left[\begin{matrix}\cos{\theta}\cos{\psi}&\sin{\phi}\sin{\theta}\cos{\psi}-\cos{\phi}\sin{\psi}&\cos{\phi}\sin{\theta}\cos{\psi}+\sin{\phi}\sin{\psi}\\\cos{\theta}\sin{\psi}&\sin{\phi}\sin{\theta}\sin{\psi}-\cos{\phi}\cos{\psi}&\cos{\phi}\sin{\theta}\sin{\psi}-\sin{\phi}\cos{\psi}\\-\sin{\theta}&\sin{\phi}\cos{\theta}&\cos{\phi}\cos{\theta}\\\end{matrix}\right]$


これを機体座標系に左からかけると，方角ごとの対気速度が得られます．

\left[\begin{matrix}\mathrm{V_N_a}\\\mathrm{V_E_a}\\\mathrm{V_D_a}\\\end{matrix}\right]=\mathbit{R}\left[\begin{matrix}U\\V\\W\\\end{matrix}\right]

### 4.風向ベクトルを求め，地図にプロットする
風上を指すベクトルの各成分は以下のように求められます．

$
\mathrm{V_N_w}=\mathrm{V_N_a}-\mathrm{V_N_g\bigm}\mathrm{V_E_w}=\mathrm{V_E_a}-\mathrm{V_E_g\bigm}\mathrm{V_D_w}=\mathrm{V_D_a}-\mathrm{V_D_g}
$

コマンドウィンドウやCSVでテーブルを出力できますが，やはりわかりにくいので地図にプロットすることをおすすめします．MATLABのgeoplot関数を利用すれば，簡単に経路を地図上に表示できます．（アドオン Mapping Toolbox が必要です．）ただし，ベクトルを表すための矢印はプリセットにないため，自分で書く必要があります．

今回は，各測定点におけるV_N_wとV_E_wを合成したベクトルをプロットしました．出力したプロットを以下に示します．ただし，風向ベクトルは風上を指しています．
 
飛行経路（水色の実線）と風向ベクトル（黄色の矢印）
まず，今年のフライトでは正対ほぼ無風（0~1m/s）であったことを踏まえて評価をしたいと思います．離陸直後はAoSの振動の影響か大きな乱れがありますが，画像中央あたりでは，ほぼ正対で0~1m/sの風向ベクトルが求められ，実際の状況と一致しています．旋回開始後しばらくしてから風向きが反対向きになっている部分がありますが，これはピッチやロールの変化による気流などが影響していると考えられます．

今回得た風向ベクトルの解析結果は，鳥科で使用しているシミュレーター上で再現し，機体性能の確認やパイロットの訓練に利用していきたいと考えています．今回の解析に用いたスクリプトはGitHubで公開しています．

	https://github.com/TORICA-Org/25th_Analysis


最後に，これらの解析手法は「チームあざみ野」のへーりんさん制作の解析用スクリプトなどを参考にさせて頂きました．誠にありがとうございました．
 
左右分割型ラダーレバー
鳥科ではラダーのみをサーボモーターによって駆動する，フライ・バイ・ワイヤの形式を採っています．エレベーターは無く，パイロットの体重移動によりピッチを調節します．パイロットが違和感なく操作できるよう，以下の設計要件を定め製作を進めました．

1. 確実にセンタリングできること．
2. 緊急回避のため，フル入力を正しく検出すること．
3. パイロットの体重移動によるピッチの調節と同時に操作できるようにすること．
製作
設計要件3の根本的解決のために，フレームから手を放さずに操作できる左右分離型のレバーを製作することにしました．パイロットが乗り込み時に全体重をかけてしまったとしても壊れない耐久性が求められると考え，材料は金属を使用することにしました．しかしながら，丸棒材などから削りだすことは不可能だと考え，ロイヤルホームセンターで販売されていたステンレス製の隅金を使用しました．レバー本体には長さが85.5mmのフラットな金具を使用しました．これにタミヤ製のクランクアームを金具の穴に合わせてねじ止めし，イモネジで検出軸に対して固定しました．（イモネジが当たる部分には事前にくぼみをつけておきました．）検出軸の軸受けには，コの字型の金具を使用しました．軸受けを固定する土台は，1.5mm厚のアルミ板をT字に切り出して作りました．
 
主な使用部材
操作量の検出には，アルプスアルパイン社製の抵抗式ポジションセンサー RDC501051Aを使用しました．φ3.5の一部が面取りされた半月状の検出軸を用意する必要がありましたが，どこにも売っていなかったためM3.5のネジをヤスリで削って手作りしました．
 	 
軸受けの反対側には，ポジションセンサーの基板を固定しました．フレームに対しては，ホースバンドで固定するようにしました．最後に，レバーの位置の復元に関しては，ホースバンドでフレームに固定したパッドアイと，レバーの穴との間に引きバネをかけることで行いました．
 
結果
左のラダーの入力が戻りきらず，ゲートオープンの時点でラダーの後縁が左に10~20mmずれていました．これは，飛行経路が左にそれた一因になったと考えられます．以下にラダーの離陸前挙動を示します．
 
429000 msから437000 msのゼロ入力でニュートラルを合わせたあと，438000 ms付近で動作確認のためにラダーを左右に駆動させています．動作確認後の440000 ms以降，動作確認前に比べてラダー入力値が-7程度オフセットしています．-7のオフセットがかかっていた場合，垂直尾翼の駆動角は，

-7\times\frac{135}{4000}=-0.23625\ \mathrm{deg}

であり，200 mm離れた位置の変位は，これを円弧とみなして

200\times0.23625\times\frac{\pi}{180}\simeq0.825\ mm

とわかりますが，これはほぼ無視できる値です．見てわかるずれ（10~20mm）があったことを考えると，サーボモーターのデッドバンド（ニュートラル帯域）が関係している可能性があります．
 
総評
使用したポジションセンサーについて，安価であるにもかかわらず，リニアリティ（直線性）が±2%（=±6.666°）と抵抗式としては最高レベルの十分な精度があり，回転に必要なトルクが2mN･mと非常に小さく無視できるなど，非常に使いやすいものでした．

結果として僅かながらセンタリングが正しく行われなかったのは，パイロット保護のための養生がレバー可動域に干渉したためだと思われます．この操縦桿はフェアリングへの干渉を恐れて，フレームの内側に部品が多く配置されるように設計しました．その結果，養生が多くなり，レバー位置が復元しにくくなったと考えられます．パイロット保護の観点を設計段階から持っていなくてはなりませんでした．ここが一番の反省です．

このレバーのセッティングを何度もやって得た知見は，ホースバンドを使ったフレームへの固定はとてもやり難いということです．操縦桿本体の固定は事前に済ませておくことができましたが，引きバネの伸びを調整するにはパッドアイの固定位置をずらすしかなかったので，非常にやりにくかったです．さらに，運用中にホースバンドで手を切る事故も発生しました．人の手が届きやすい場所に，鋭利な部品を採用すべきではありませんでした．

また，金属を多用する必要性はあまりなかったかもしれないと考えています．基本的にフレームを握ることが前提で，操作するにしても人差し指でしか操作しません．パイロットは人差し指での操作をシミュレーターで練習していたことにより十分に慣れていましたので，離陸で慌てたとしても操縦桿を破壊することはなかったといえます．
 
これらを踏まえ，これからの改善点をまとめます．

	フレームの内側など，パイロットに危険が及ぶ可能性のある配置・構造にしないこと．
	ホースバンドではない，他の固定方法を採用すること．
	引きバネではどうしても固定場所を他に作らなければならないため，位置の復元には押しバネやキックバネを用いること．
	より柔軟な設計ができる，3Dプリンターを活用して製作すること．

操縦桿については以上になります．飛行戦略を実現させるために必要不可欠な操舵系統を，より洗練されたものにしていく所存です．

